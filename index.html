

<!DOCTYPE HTML>
<html>
<body>

<canvas id="myCanvas" width="1200" height="600">your browser does not support the canvas tag </canvas>

<script type="text/javascript">

var width = 1200;
var height = 600;
//var ballPerSeconds = 40;//每秒小球产生数
var total = 2000;
var R = 4;

var pi = Math.PI*2;

var canvas=document.getElementById('myCanvas');
var ctx=canvas.getContext('2d');
var allBalls = new Array();

var mainball={};


function Ball()//小球构造器函数
{
	this.x = R+(width-2*R)*Math.random();
	this.y = R+(height-2*R)*Math.random();
	this.vx = -2+4*Math.random();
	this.vy = -2+4*Math.random();
}

function create()//产生小球
{
	var cre ;
	var ball = new Ball();
	allBalls.push(ball);
	for(cre=0;cre<total;cre++)
	{
		var temball = new Ball();
		var t = 0;
		var L = allBalls.length;
		for(d=0; d < L ; d++)
		{
			var disx = temball.x - allBalls[d].x;
			var disy = temball.y - allBalls[d].y;
			if(disx*disx+disy*disy <= 4*R*R)
			{
				t++;
			}
		}
		if(t===0)
			allBalls.push(temball);
	
	}
	
	/*
	for(d=0;d<allBalls.length;d++)
	{
		for(f=d+1;f<allBalls.length;f++)
		{
			var disx = allBalls[d].x - allBalls[f].x;
			var disy = allBalls[d].y - allBalls[f].y; 
			if( disx*disx+disy*disy <= 4*R*R)
			{
				if(disx < 0){
				allBalls[f].x = allBalls[f].x + R;
				}
				if(disx > 0){
				allBalls[f].x = allBalls[f].x - R;
				}
				if(disy < 0){
				allBalls[f].y = allBalls[f].y + R;
				}
				if(disx > 0){
				allBalls[f].y = allBalls[f].y - R;
				}
			}
		}
	}*/
	
}


function draw()
{
	ctx.clearRect(0,0,1200,800);
	var L = allBalls.length;
	for(i=0;i<L;i++)
	{ 
	ctx.beginPath();
	ctx.arc(allBalls[i].x, allBalls[i].y, R, 0, pi, true); 
	ctx.fillStyle = "#35D2AB"; 
	ctx.fill();
	}
}

function act()
{
	var L = allBalls.length;
	for(i=0;i<L;i++)
	{	
		//碰撞边界	
		if(allBalls[i].x < R){
			allBalls[i].x = R;
			allBalls[i].vx = 0 - allBalls[i].vx;
		}
		if(allBalls[i].x >width-R){
			allBalls[i].x = width-R;
			allBalls[i].vx = 0 - allBalls[i].vx;
		}
		
		if(allBalls[i].y < R){
			allBalls[i].y = R;
			allBalls[i].vy = 0 - allBalls[i].vy;
		}
		if(allBalls[i].y > height-R){
			allBalls[i].y = height-R;
			allBalls[i].vy = 0 - allBalls[i].vy;
		}
		allBalls[i].x = allBalls[i].x + allBalls[i].vx;
		allBalls[i].y = allBalls[i].y + allBalls[i].vy;
		
		//小球间
		var L = allBalls.length;
		for(j=i+1;j<L;j++)
		{
			var disx = allBalls[i].x - allBalls[j].x;
			var disy = allBalls[i].y - allBalls[j].y;
			var dis =Math.sqrt(disx*disx+disy*disy);
			var vi = Math.sqrt(allBalls[i].vx*allBalls[i].vx+allBalls[i].vy*allBalls[i].vy);
			var vj = Math.sqrt(allBalls[j].vx*allBalls[j].vx+allBalls[j].vy*allBalls[j].vy);
			if(dis < 2*R)
			{
				allBalls[i].x = allBalls[i].x+(2*R-dis)*disx/dis/2;
				allBalls[i].y = allBalls[i].y+(2*R-dis)*disy/dis/2;
				allBalls[j].x = allBalls[j].x-(2*R-dis)*disx/dis/2;
				allBalls[j].y = allBalls[j].y-(2*R-dis)*disx/dis/2;

				var tempx = allBalls[i].vx;
				var tempy = allBalls[i].vy;
				allBalls[i].vx = allBalls[j].vx ;
				allBalls[i].vy = allBalls[j].vy ;
				allBalls[j].vx = tempx ;
				allBalls[j].vy = tempy ;
			}	
		}	
	}
}
function stark()
{
draw();
act();
}
create();
setInterval("stark()", 30);


</script>
</body>
</html>
